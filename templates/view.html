<!DOCTYPE html>
<html>
<head>
    <title>View Image</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <h2>Viewing Image {{ index + 1 }} of {{ total }}</h2>

    <div class="single-image-container">
        <img src="{{ url_for('static', filename=image) }}" alt="Image" class="single-image" id="image-viewer">
    </div>

    <div class="nav-buttons">
        {% if index > 0 %}
            <a id="prevBtn" href="{{ url_for('view_image', index=index-1) }}"><button>Previous</button></a>
        {% endif %}
        <a href="{{ url_for('gallery') }}"><button>Back to Gallery</button></a>
        {% if index < total - 1 %}
            <a id="nextBtn" href="{{ url_for('view_image', index=index+1) }}"><button>Next</button></a>
        {% endif %}
        <button id="playBtn">▶ Play</button>
        <button id="pauseBtn" disabled>⏸ Pause</button>
    </div>

    <script>
        let currentIndex = {{ index }};
        const totalImages = {{ total }};
        const baseUrl = "{{ url_for('view_image', index=0) }}";
        let slideshowInterval = null;

        function goToIndex(idx) {
            if (idx >= 0 && idx < totalImages) {
                window.location.href = baseUrl.replace(/0$/, idx);
            }
        }

        document.addEventListener("keydown", function (e) {
            if (e.key === "ArrowLeft" && currentIndex > 0) {
                goToIndex(currentIndex - 1);
            } else if (e.key === "ArrowRight" && currentIndex < totalImages - 1) {
                goToIndex(currentIndex + 1);
            } else if (e.key === "Escape") {
                window.location.href = "{{ url_for('gallery') }}";
            }
        });

        document.getElementById("playBtn").addEventListener("click", function () {
            this.disabled = true;
            document.getElementById("pauseBtn").disabled = false;
            slideshowInterval = setInterval(() => {
                if (currentIndex < totalImages - 1) {
                    currentIndex += 1;
                    goToIndex(currentIndex);
                } else {
                    clearInterval(slideshowInterval);
                    this.disabled = false;
                    document.getElementById("pauseBtn").disabled = true;
                }
            }, 3000);
        });

        document.getElementById("pauseBtn").addEventListener("click", function () {
            clearInterval(slideshowInterval);
            this.disabled = true;
            document.getElementById("playBtn").disabled = false;
        });
    </script>
</body>
</html>
