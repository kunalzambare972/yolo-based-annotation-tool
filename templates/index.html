<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YOLO Annotation Tool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        .hero {
            background: linear-gradient(135deg, #1976d2, #2c3e50);
            color: #fff;
            padding: 3rem 0;
            margin-bottom: 2rem;
            text-align: center;
            border-radius: 0 0 50px 50px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto;
            opacity: 0.9;
        }
        
        .form-card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .form-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-title i {
            color: #1976d2;
        }
        
        .input-group {
            margin-bottom: 1rem;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e0e6ed;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.2s;
        }
        
        .input-group input:focus, .input-group select:focus {
            border-color: #1976d2;
            outline: none;
            box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.2);
        }
        
        .drag-area {
            border: 2px dashed #ccc;
            padding: 2rem;
            text-align: center;
            border-radius: 6px;
            margin: 1rem 0;
            transition: all 0.3s;
        }
        
        .drag-area.active {
            border-color: #1976d2;
            background: rgba(25, 118, 210, 0.05);
        }
        
        .drag-area i {
            font-size: 48px;
            color: #b0bec5;
            margin-bottom: 1rem;
        }
        
        .drag-area p {
            margin-bottom: 1rem;
            color: #607d8b;
        }
        
        .file-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 1rem;
        }
        
        .file-item {
            background: #f0f5ff;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: #1976d2;
        }
        
        .file-item i {
            color: #1976d2;
        }
        
        .projects-list {
            margin-top: 2rem;
        }
        
        .project-card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: transform 0.3s;
            border-left: 4px solid #1976d2;
        }
        
        .project-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        }
        
        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .project-title {
            font-size: 1.2rem;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .project-stats {
            display: flex;
            gap: 15px;
            color: #607d8b;
            font-size: 0.9rem;
        }
        
        .project-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .project-date {
            color: #90a4ae;
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }
        
        .project-actions {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="hero">
        <h1><i class="fas fa-tags"></i> YOLO Annotation Tool</h1>
        <p>Create, manage, and annotate image datasets for YOLO object detection models.</p>
    </div>

    <div class="container">
        <div class="form-card">
            <h2 class="form-title"><i class="fas fa-folder-plus"></i> Create New Project</h2>
            <div class="input-group">
                <label for="projectName">Project Name</label>
                <input type="text" id="projectName" placeholder="Enter project name">
            </div>
            <button id="createProject" class="btn btn-success">
                <i class="fas fa-plus-circle"></i> Create Project
            </button>
        </div>
        
        <div id="uploadSection" class="form-card" style="display: none;">
            <h2 class="form-title"><i class="fas fa-cloud-upload-alt"></i> Upload Images</h2>
            <p class="project-selected">Selected Project: <strong id="selectedProject"></strong></p>
            
            <div class="drag-area" id="dragArea">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Drag & Drop Images Here</p>
                <p>OR</p>
                <button id="browseFiles" class="btn btn-outline">
                    <i class="fas fa-folder-open"></i> Browse Files
                </button>
                <input type="file" id="fileInput" multiple accept=".jpg,.jpeg,.png,.bmp,.webp" style="display: none;">
            </div>
            
            <div id="fileList" class="file-list"></div>
            
            <div style="margin-top: 1rem;">
                <button id="uploadFiles" class="btn btn-success" disabled>
                    <i class="fas fa-upload"></i> Upload Images
                </button>
            </div>
        </div>
        
        <div class="projects-list">
            <h2 class="form-title"><i class="fas fa-project-diagram"></i> Your Projects</h2>
            
            {% if projects %}
                {% for project in projects %}
                <div class="project-card">
                    <div class="project-header">
                        <div class="project-title">{{ project.name }}</div>
                        <div class="project-stats">
                            <div class="project-stat">
                                <i class="fas fa-images"></i> {{ project.image_count }} images
                            </div>
                        </div>
                    </div>
                    <div class="project-date">
                        <i class="far fa-calendar-alt"></i> Created on {{ project.created.split(' ')[0] }}
                    </div>
                    <div class="project-actions">
                        <a href="/annotate?project_name={{ project.name }}" class="btn">
                            <i class="fas fa-tags"></i> Annotate
                        </a>
                        <button class="btn btn-outline upload-to-project" data-project="{{ project.name }}">
                            <i class="fas fa-upload"></i> Add Images
                        </button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-folder-open"></i>
                    <h3>No projects yet</h3>
                    <p>Create your first project to get started.</p>
                </div>
            {% endif %}
        </div>
    </div>
    
    <div id="notification" class="notification"></div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Create project
            const createProjectBtn = document.getElementById('createProject');
            const projectNameInput = document.getElementById('projectName');
            const uploadSection = document.getElementById('uploadSection');
            const selectedProjectText = document.getElementById('selectedProject');
            
            createProjectBtn.addEventListener('click', function() {
                const projectName = projectNameInput.value.trim();
                if (!projectName) {
                    showNotification('Please enter a project name', 'error');
                    return;
                }
                
                fetch('/create_project', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `project_name=${encodeURIComponent(projectName)}`
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showNotification('Project created successfully!', 'success');
                        selectedProjectText.textContent = projectName;
                        uploadSection.style.display = 'block';
                        projectNameInput.value = '';
                        setupUpload(projectName);
                        
                        // Reload the page after a delay to show the new project
                        setTimeout(() => {
                            location.reload();
                        }, 1500);
                    } else {
                        showNotification('Error creating project', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Error creating project', 'error');
                });
            });
            
            // Setup upload buttons on existing projects
            document.querySelectorAll('.upload-to-project').forEach(button => {
                button.addEventListener('click', function() {
                    const projectName = this.getAttribute('data-project');
                    selectedProjectText.textContent = projectName;
                    uploadSection.style.display = 'block';
                    setupUpload(projectName);
                    
                    // Scroll to upload section
                    uploadSection.scrollIntoView({ behavior: 'smooth' });
                });
            });
            
            function setupUpload(projectName) {
                const dragArea = document.getElementById('dragArea');
                const fileInput = document.getElementById('fileInput');
                const browseBtn = document.getElementById('browseFiles');
                const fileList = document.getElementById('fileList');
                const uploadBtn = document.getElementById('uploadFiles');
                
                let files = [];
                
                browseBtn.addEventListener('click', function() {
                    fileInput.click();
                });
                
                fileInput.addEventListener('change', function() {
                    const selectedFiles = Array.from(fileInput.files);
                    handleFiles(selectedFiles);
                });
                
                dragArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    dragArea.classList.add('active');
                });
                
                dragArea.addEventListener('dragleave', function() {
                    dragArea.classList.remove('active');
                });
                
                dragArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    dragArea.classList.remove('active');
                    const droppedFiles = Array.from(e.dataTransfer.files);
                    handleFiles(droppedFiles);
                });
                
                function handleFiles(newFiles) {
                    const validFiles = newFiles.filter(file => {
                        const ext = file.name.split('.').pop().toLowerCase();
                        return ['jpg', 'jpeg', 'png', 'bmp', 'webp'].includes(ext);
                    });
                    
                    if (validFiles.length === 0) {
                        showNotification('Please select valid image files', 'error');
                        return;
                    }
                    
                    files = validFiles;
                    updateFileList();
                    uploadBtn.disabled = files.length === 0;
                }
                
                function updateFileList() {
                    fileList.innerHTML = '';
                    files.forEach(file => {
                        const fileItem = document.createElement('div');
                        fileItem.className = 'file-item';
                        fileItem.innerHTML = `
                            <i class="far fa-file-image"></i>
                            <span>${file.name}</span>
                        `;
                        fileList.appendChild(fileItem);
                    });
                }
                
                uploadBtn.addEventListener('click', function() {
                    if (files.length === 0) return;
                    
                    const formData = new FormData();
                    files.forEach(file => {
                        formData.append('files', file);
                    });
                    
                    uploadBtn.disabled = true;
                    uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
                    
                    fetch(`/upload/${encodeURIComponent(projectName)}`, {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => {
                        if (response.redirected) {
                            window.location.href = response.url;
                        } else {
                            return response.json();
                        }
                    })
                    .then(data => {
                        if (data && data.status === 'success') {
                            showNotification('Images uploaded successfully!', 'success');
                            files = [];
                            updateFileList();
                            uploadBtn.disabled = true;
                        } else if (!response.redirected) {
                            showNotification('Error uploading images', 'error');
                            uploadBtn.disabled = false;
                        }
                        uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Images';
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Images';
                        uploadBtn.disabled = false;
                    });
                });
            }
            
            function showNotification(message, type) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type} show`;
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        });
    </script>
</body>
</html>